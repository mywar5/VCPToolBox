# VCP元思考 - 递归推理链使用指南

## 概述

VCP元思考是一个革命性的递归RAG系统，它能够通过多阶段的向量融合和推理，构建出结构化的思维链路，让AI从简单的"信息检索"进化为"结构化思考"。

## 核心原理

### 递归向量增强流程

```
用户输入 → 向量化 → 
  ↓
阶段1: 前思维簇 (k=2) → 召回2个元逻辑 → 向量融合(40%上下文 + 60%结果)
  ↓
阶段2: 逻辑推理簇 (k=1) → 召回1个元逻辑 → 向量融合
  ↓
阶段3: 反思簇 (k=1) → 召回1个元逻辑 → 向量融合
  ↓
阶段4: 结果辩证簇 (k=1) → 召回1个元逻辑 → 向量融合
  ↓
阶段5: 陈词总结梳理簇 (k=1) → 召回1个元逻辑 → 完整思维链
```

每一阶段的结果都会影响下一阶段的查询方向，形成真正的"思考递进"。

## 语法规范

### 基础语法

```
[[VCP元思考:<链名称>::<修饰符>:<k1-k2-k3-k4-k5>]]
```

### 参数说明

1. **链名称** (可选，默认为 `default`)
   - `default`: 默认思维链（前思维→逻辑推理→反思→结果辩证→陈词总结）
   - 可在 `meta_thinking_chains.json` 中自定义更多链

2. **修饰符** (可选)
   - `::Group`: 启用语义组增强，让向量化更"懂"上下文

3. **K值序列** (必需)
   - 格式: `k1-k2-k3-k4-k5`
   - 每个数字对应一个簇的召回数量
   - 必须与链中的簇数量一致（默认链有5个簇）

### 使用示例

#### 示例1：基础用法（推荐）
```
[[VCP元思考::Group:2-1-1-1-1]]
```
- 使用默认链
- 启用语义组增强
- 第一阶段返回2个结果，其余阶段各返回1个

#### 示例2：提高某阶段的召回深度
```
[[VCP元思考::Group:3-2-1-1-1]]
```
- 前思维阶段返回3个
- 逻辑推理阶段返回2个
- 适合需要更深入前期分析的场景

#### 示例3：全链高密度召回
```
[[VCP元思考::Group:2-2-2-2-2]]
```
- 所有阶段都返回2个元逻辑
- 适合复杂问题，需要充分的思考深度

#### 示例4：不使用语义组
```
[[VCP元思考:1-1-1-1-1]]
```
- 纯粹基于向量相似度
- 每阶段返回1个结果

## 配置文件

### meta_thinking_chains.json

```json
{
  "chains": {
    "default": [
      "前思维簇",
      "逻辑推理簇",
      "反思簇",
      "结果辩证簇",
      "陈词总结梳理簇"
    ]
  }
}
```

### 自定义思维链

你可以添加新的思维链定义：

```json
{
  "chains": {
    "default": [...],
    "creative_writing": [
      "灵感火花簇",
      "情节构建簇",
      "角色深化簇",
      "世界观设定簇"
    ]
  }
}
```

使用方式：
```
[[VCP元思考:creative_writing::Group:2-1-1-1]]
```

## 日记本结构要求

每个簇文件夹（如 `前思维簇`）下应包含多个 `.txt` 文件，每个文件代表一个独立的"元逻辑模块"。

### 目录结构示例

```
dailynote/
├── 前思维簇/
│   ├── 模块1.txt
│   ├── 模块2.txt
│   └── ...
├── 逻辑推理簇/
│   ├── 推理模式A.txt
│   ├── 推理模式B.txt
│   └── ...
├── 反思簇/
│   └── ...
├── 结果辩证簇/
│   └── ...
└── 陈词总结梳理簇/
    └── ...
```

## VCP可视化调试

系统会自动推送详细的执行信息到VCP Log，包括：

- 思维链名称和路径
- 激活的语义组
- 每个阶段的召回结果
- 向量融合过程

在 `RAG_Observer.html` 中可以实时查看整个递归推理过程。

## 最佳实践

### 1. K值序列设计原则

- **前期宽度，后期收敛**：`3-2-1-1-1` 或 `2-2-1-1-1`
  - 前期多召回，建立广泛的思考基础
  - 后期精准聚焦，形成清晰结论

- **均衡探索**：`2-2-2-2-2`
  - 每个阶段都保持适度的选择空间
  - 适合复杂、多维度的问题

- **快速推理**：`1-1-1-1-1`
  - 每阶段只选最相关的一个模块
  - 适合简单、直接的问题

### 2. 语义组的使用时机

- ✅ **推荐使用 `::Group`**：当用户输入涉及特定领域、情感或专业术语时
- ❌ **不推荐使用**：当需要纯粹基于语义相似度的通用推理时

### 3. 元逻辑模块的编写

每个 `.txt` 文件应该：
- 包含一个独立、完整的思考单元
- 可以被单独理解和应用
- 避免依赖其他模块的上下文
- 长度适中（建议200-500字）

## 技术细节

### 向量融合权重

```javascript
currentQueryVector = (contextVector * 0.4) + (resultVector * 0.6)
```

- **40% 上下文权重**：保持与原始问题的关联性
- **60% 结果权重**：让推理能够逐步深入和递进

这个比例经过精心设计，平衡了"不偏离主题"和"能够深入思考"两个需求。

### 多结果向量处理

当某阶段返回多个结果时，系统会：
1. 获取每个结果的向量
2. 计算平均向量
3. 用平均向量与上下文向量融合

这确保了多个思考方向能够被综合考虑。

## 故障排查

### 问题1：提示"未找到元逻辑模块"

**原因**：对应的簇文件夹不存在或为空

**解决方案**：
1. 检查 `dailynote/` 目录下是否存在对应的簇文件夹
2. 确保文件夹内有 `.txt` 文件
3. 运行系统让 `VectorDBManager` 重新索引

### 问题2：思维链执行缓慢

**原因**：K值过大，导致需要获取大量向量

**解决方案**：
1. 降低K值序列（如从 `3-3-3-3-3` 改为 `2-1-1-1-1`）
2. 检查网络连接和Embedding API响应速度

### 问题3：推理结果不理想

**原因**：元逻辑模块质量不高或向量未正确索引

**解决方案**：
1. 优化元逻辑模块的内容，确保其独立性和完整性
2. 删除 `VectorStore/` 中对应的 `.bin` 和 `_map.json` 文件，让系统重建索引
3. 尝试调整K值序列

## 未来扩展

系统架构已预留扩展接口，未来可以：

1. **动态权重调整**：根据上下文复杂度自动调整融合权重
2. **多路径探索**：同时尝试多个思维链，选择最佳结果
3. **反馈学习**：根据AI输出质量调整召回策略
4. **混合模式**：在同一个思维链中混合使用不同的召回策略

---

**版本**: 1.0.0  
**最后更新**: 2025-10-11  
**作者**: VCP Lionsky